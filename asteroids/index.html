<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Asteroids</title>
<style>
  body {
    margin: 0;
    background: black;
    overflow: hidden;
  }
  canvas {
    display: block;
  }
</style>
</head>
<body>
<canvas id="game"></canvas>

<script>
/* =========================
   Setup
========================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

/* =========================
   Utilities
========================= */
function wrap(obj) {
  if (obj.x < 0) obj.x += canvas.width;
  if (obj.x > canvas.width) obj.x -= canvas.width;
  if (obj.y < 0) obj.y += canvas.height;
  if (obj.y > canvas.height) obj.y -= canvas.height;
}

function rand(min, max) {
  return Math.random() * (max - min) + min;
}

/* =========================
   Input
========================= */
const keys = {};
window.addEventListener("keydown", e => keys[e.code] = true);
window.addEventListener("keyup", e => keys[e.code] = false);

/* =========================
   Ship
========================= */
const ship = {
  x: canvas.width / 2,
  y: canvas.height / 2,
  vx: 0,
  vy: 0,
  angle: -Math.PI / 2,
  radius: 12,
  rotationSpeed: 4,   // rad/sec
  thrust: 200
};

/* =========================
   Bullets
========================= */
const bullets = [];
const BULLET_SPEED = 500;
const BULLET_LIFE = 1.2;

/* =========================
   Asteroids
========================= */
const asteroids = [];

function spawnAsteroid(size = 3, x, y) {
  asteroids.push({
    x: x ?? rand(0, canvas.width),
    y: y ?? rand(0, canvas.height),
    vx: rand(-60, 60),
    vy: rand(-60, 60),
    angle: rand(0, Math.PI * 2),
    rotation: rand(-1, 1),
    size,
    radius: size * 20
  });
}

// initial asteroids
for (let i = 0; i < 5; i++) spawnAsteroid();

/* =========================
   Game Loop
========================= */
let lastTime = 0;

function loop(time) {
  const dt = (time - lastTime) / 1000;
  lastTime = time;

  update(dt);
  render();

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* =========================
   Update
========================= */
function update(dt) {
  // rotation
  if (keys["ArrowLeft"]) ship.angle -= ship.rotationSpeed * dt;
  if (keys["ArrowRight"]) ship.angle += ship.rotationSpeed * dt;

  // thrust
  if (keys["ArrowUp"]) {
    ship.vx += Math.cos(ship.angle) * ship.thrust * dt;
    ship.vy += Math.sin(ship.angle) * ship.thrust * dt;
  }

  // fire
  if (keys["Space"] && bullets.length < 5) {
    keys["Space"] = false;
    bullets.push({
      x: ship.x + Math.cos(ship.angle) * ship.radius,
      y: ship.y + Math.sin(ship.angle) * ship.radius,
      vx: ship.vx + Math.cos(ship.angle) * BULLET_SPEED,
      vy: ship.vy + Math.sin(ship.angle) * BULLET_SPEED,
      life: BULLET_LIFE
    });
  }

  // move ship
  ship.x += ship.vx * dt;
  ship.y += ship.vy * dt;
  wrap(ship);

  // move bullets
  for (let i = bullets.length - 1; i >= 0; i--) {
    const b = bullets[i];
    b.x += b.vx * dt;
    b.y += b.vy * dt;
    b.life -= dt;
    wrap(b);
    if (b.life <= 0) bullets.splice(i, 1);
  }

  // move asteroids
  asteroids.forEach(a => {
    a.x += a.vx * dt;
    a.y += a.vy * dt;
    a.angle += a.rotation * dt;
    wrap(a);
  });

  // collisions
  checkCollisions();
}

/* =========================
   Collisions
========================= */
function dist(a, b) {
  return Math.hypot(a.x - b.x, a.y - b.y);
}

function checkCollisions() {
  for (let i = asteroids.length - 1; i >= 0; i--) {
    const a = asteroids[i];

    // bullet hits asteroid
    for (let j = bullets.length - 1; j >= 0; j--) {
      const b = bullets[j];
      if (dist(a, b) < a.radius) {
        bullets.splice(j, 1);
        asteroids.splice(i, 1);

        if (a.size > 1) {
          spawnAsteroid(a.size - 1, a.x, a.y);
          spawnAsteroid(a.size - 1, a.x, a.y);
        }
        break;
      }
    }
  }
}

/* =========================
   Render
========================= */
function render() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // ship
  ctx.save();
  ctx.translate(ship.x, ship.y);
  ctx.rotate(ship.angle);
  ctx.strokeStyle = "white";
  ctx.beginPath();
  ctx.moveTo(15, 0);
  ctx.lineTo(-10, -8);
  ctx.lineTo(-6, 0);
  ctx.lineTo(-10, 8);
  ctx.closePath();
  ctx.stroke();
  ctx.restore();

  // bullets
  ctx.fillStyle = "white";
  bullets.forEach(b => {
    ctx.beginPath();
    ctx.arc(b.x, b.y, 2, 0, Math.PI * 2);
    ctx.fill();
  });

  // asteroids
  asteroids.forEach(a => {
    ctx.save();
    ctx.translate(a.x, a.y);
    ctx.rotate(a.angle);
    ctx.strokeStyle = "white";
    ctx.beginPath();
    for (let i = 0; i < 8; i++) {
      const angle = (i / 8) * Math.PI * 2;
      const r = a.radius + rand(-5, 5);
      ctx.lineTo(Math.cos(angle) * r, Math.sin(angle) * r);
    }
    ctx.closePath();
    ctx.stroke();
    ctx.restore();
  });
}
</script>
</body>
</html>
